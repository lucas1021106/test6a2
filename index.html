<html lang="zh-Hant"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>線上選擇題測驗</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');

        body {
            font-family: 'Orbitron', sans-serif;
            background: #0f0f0f;
            color: #0ff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }

        .quiz-container, .generator-container {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #0ff;
            border-radius: 10px;
            box-shadow: 0 0 20px #0ff;
            padding: 20px;
            max-width: 600px;
            width: 100%;
            text-align: center;
            display: none;
        }

        .quiz-container.active, .generator-container.active {
            display: block;
        }

        .question {
            font-size: 24px;
            margin-bottom: 20px;
            border-bottom: 2px solid #0ff;
            padding-bottom: 10px;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .options button {
            padding: 10px;
            font-size: 18px;
            font-weight: bold;
            color: green;
            border: 1px solid #0ff;
            background: #333;
            cursor: pointer;
            transition: all 0.3s;
            height: 80px;
            border-radius: 5px;
        }

        .options button:hover {
            background: #0ff;
            color: #000;
            border: 1px solid #333;
            box-shadow: 0 0 10px #0ff;
        }

        .options button.selected {
            border: 3px solid red;
        }

        .navigation {
            margin-top: 20px;
        }

        .navigation button {
            padding: 10px 20px;
            font-size: 18px;
            border: 1px solid #0ff;
            background: #333;
            color: #0ff;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px;
        }

        .navigation button:hover {
            background: #0ff;
            color: #000;
            border: 1px solid #333;
            box-shadow: 0 0 10px #0ff;
        }

        .question-counter {
            margin-top: 20px;
            font-size: 18px;
        }

        .result-layer {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            color: #0ff;
            overflow-y: auto;
            align-items: center;
            justify-content: center;
        }

        .result-content {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #0ff;
            border-radius: 10px;
            padding: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80%;
            box-shadow: 0 0 20px #0ff;
            overflow-y: auto;
        }

        .result-content h2 {
            margin-top: 0;
        }

        .result-content button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            border: 1px solid #0ff;
            background: #333;
            color: #0ff;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px;
        }

        .result-content button:hover {
            background: #0ff;
            color: #000;
            border: 1px solid #333;
            box-shadow: 0 0 10px #0ff;
        }

        .incorrect {
            color: red;
        }

        .correct {
            color: green;
        }

        .wrong-answer {
            color: green;
        }

        .correct-answer {
            color: blue;
            font-weight: bold;
            font-size: 21px;
        }

        .wrong-question {
            color: green;
            font-weight: bold;
        }

        table {
            width: 100%;
            height: 20%;
            border-collapse: collapse;
        }

        td {
            vertical-align: middle;
            text-align: center;
            font-size: 24px;
        }

        .footer {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 14px;
        }

        .footer a {
            color: #0ff;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .click-area {
            position: absolute;
            bottom: 10px;
            left: 10px;
            width: 50px;
            height: 50px;
            background: transparent;
            cursor: pointer;
        }

        .input-container {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .input-container textarea {
            width: 100%;
            padding: 10px;
            font-size: 18px;
            border: 1px solid #0ff;
            border-radius: 5px;
            background: #333;
            color: #0ff;
            height: 200px;
        }

        .input-container button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            border: 1px solid #0ff;
            background: #333;
            color: #0ff;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px;
        }

        .input-container button:hover {
            background: #0ff;
            color: #000;
            border: 1px solid #333;
            box-shadow: 0 0 10px #0ff;
        }

        .output-table {
            margin-top: 20px;
            font-size: 10px;
            width: 100%;
            color: #fff;
        }

        .output-table th, .output-table td {
            border: 1px solid #0ff;
            padding: 5px;
            font-size: 10px;
        }

        .output-table th {
            background: #333;
        }

        .output-table td {
            background: #444;
        }

        .start-quiz-btn {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            border: 1px solid #0ff;
            background: #333;
            color: #0ff;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px;
        }

        .start-quiz-btn:hover {
            background: #0ff;
            color: #000;
            border: 1px solid #333;
            box-shadow: 0 0 10px #0ff;
        }

        .download-btn {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            border: 1px solid #0ff;
            background: #333;
            color: #0ff;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px;
        }

        .download-btn:hover {
            background: #0ff;
            color: #000;
            border: 1px solid #333;
            box-shadow: 0 0 10px #0ff;
        }
    </style>
<style>._flexBox_15diu_1{flex-flow:unset}._gap_extraTiny_15diu_5{gap:var(--size-extraTiny)}._gap_tiny_15diu_9{gap:var(--size-tiny)}._gap_extraSmall_15diu_13{gap:var(--size-extraSmall)}._gap_small_15diu_17{gap:var(--size-small)}._gap_medium_15diu_21{gap:var(--size-medium)}._gap_normal_15diu_25{gap:var(--size-normal)}._gap_large_15diu_29{gap:var(--size-large)}._gap_xLarge_15diu_33{gap:var(--size-xLarge)}._gap_xxLarge_15diu_37{gap:var(--size-xxLarge)}._gap_extraLarge_15diu_41{gap:var(--size-extraLarge)}._column_15diu_45{flex-direction:column!important}._flexWrap_15diu_49{flex-wrap:wrap}._qrlightbox_background_1k51k_1{background-color:#c8c8c880;width:100%;height:100%;position:fixed;z-index:2147483636;top:0;left:0}._backClose_1k51k_11{position:absolute;width:100%;height:100%;top:0;left:0}._qrImage_1k51k_19{width:200px;height:200px;background:#eee;background:linear-gradient(110deg,#ececec 8%,#f5f5f5 18%,#ececec 33%);background-size:200% 100%;animation:1.5s _shine_1k51k_1 linear infinite}._qrlightbox_extension_1k51k_28{padding:32px;background-color:#fff;z-index:2147483637;border:0;border-radius:10px}._title_1k51k_36{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:200px;font-size:16px;font-family:Arial,serif;font-weight:400;color:#000}@keyframes _shine_1k51k_1{to{background-position-x:-200%}}:root{--size-extraTiny: 2px;--size-tiny: 4px;--size-extraSmall: 6px;--size-small: 8px;--size-medium: 16px;--size-normal: 24px;--size-large: 32px;--size-xLarge: 48px;--size-xxLarge: 56px;--size-extraLarge: 64px;--font-size-tiny: 12px;--font-size-small: 16px;--font-size-medium: 18px;--font-size-large: 32px;--weight-thin: 100;--weight-extraLight: 200;--weight-light: 300;--weight-normal: 400;--weight-medium: 500;--weight-semiBold: 600;--weight-bold: 700;--weight-extraBold: 800}._qrlightbox_background_ffyms_1{background-color:#c8c8c880;width:100%;height:100%;position:fixed;z-index:2147483636;top:0;left:0}._backClose_ffyms_11{position:absolute;width:100%;height:100%;top:0;left:0}._qrImage_ffyms_19{width:200px;height:200px;background:#eee;background:linear-gradient(110deg,#ececec 8%,#f5f5f5 18%,#ececec 33%);background-size:200% 100%;animation:1.5s _shine_ffyms_1 linear infinite}._qrlightbox_extension_ffyms_28{padding:32px;background-color:#fff;z-index:2147483637;border:0;border-radius:10px}._title_ffyms_36{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:200px;font-size:16px;font-family:Arial,serif;font-weight:400;color:#000;margin:0}@keyframes _shine_ffyms_1{to{background-position-x:-200%}}
</style></head>
<body>

<div class="quiz-container" id="quizContainer">
    <table>
        <tbody><tr>
            <td>
                <div id="question" class="question">10的因數：</div>
            </td>
        </tr>
    </tbody></table>
    <div class="options" id="options"><button style="background-color: rgb(204, 255, 179);">4</button><button style="background-color: rgb(179, 180, 255);">8</button><button style="background-color: rgb(198, 255, 179);">5</button><button style="background-color: rgb(238, 179, 255);">7</button></div>
    <div class="question-counter" id="questionCounter">第 1 題 / 共 4 題</div>
    <div class="navigation">
        <button id="prevBtn" onclick="prevQuestion()" style="display: none;">上一題</button>
        <button id="nextBtn" onclick="nextQuestion()" style="display: inline-block;">下一題</button>
        <button id="finishBtn" onclick="finishQuiz()" style="display: none;">結束測驗</button>
    </div>
</div>

<div class="result-layer" id="resultLayer" style="display: none;">
    <div class="result-content" id="resultContent"><h2>您的總得分是 100.0 分</h2><button onclick="restartQuiz()">重新測驗</button></div>
</div>

<div class="generator-container active" id="generatorContainer">
    <h1>選擇題測驗生成器</h1>
    <div class="input-container">
        <textarea id="generatorInput" placeholder="每行一筆資料，六欄用逗號或Tab隔開">12的因數：,1,2,7,8,5
24的因數：,1,3,7,10,5
10的因數：,4,4,7,8,5
80的因數：,4,3,7,6,10</textarea>
        <button onclick="submitGenerator()">送出</button>
        <button class="download-btn" onclick="downloadQuiz()">下載完整測驗</button>
    </div>
    <div id="outputTableContainer"><table class="output-table"><thead><tr><th>題目</th><th>選項1</th><th>選項2</th><th>選項3</th><th>選項4</th><th>答案</th></tr></thead><tbody><tr><td>12的因數：</td><td>2</td><td>7</td><td>8</td><td>5</td><td>2</td></tr><tr><td>24的因數：</td><td>3</td><td>7</td><td>10</td><td>5</td><td>3</td></tr><tr><td>10的因數：</td><td>4</td><td>7</td><td>8</td><td>5</td><td>5</td></tr><tr><td>80的因數：</td><td>3</td><td>7</td><td>6</td><td>10</td><td>10</td></tr></tbody></table><button class="start-quiz-btn" onclick="startQuizFromGenerator()">開始測驗</button></div>
</div>

<div class="footer">
    Made by <atarget="_blank">ChenYiChen
</atarget="_blank"></div>

<div class="click-area" onclick="showGenerator()"></div>

<script>
    let questions = [];
    let currentQuestion = 0;
    let score = 0;
    const userAnswers = [];
    let shuffledQuestions = [];

    document.getElementById('finishBtn').style.display = 'none';

    function startQuiz() {
        shuffledQuestions = shuffleArray(questions.map(q => ({
            ...q,
            shuffledOptions: shuffleArray(q.options),
            correctAnswer: q.options[q.correct]
        })));
        currentQuestion = 0;
        score = 0;
        userAnswers.length = 0;
        displayQuestion();
    }

    function displayQuestion() {
        const questionElement = document.getElementById('question');
        const optionsElement = document.getElementById('options');
        const questionCounterElement = document.getElementById('questionCounter');

        const currentQ = shuffledQuestions[currentQuestion];
        questionElement.textContent = currentQ.question;
        optionsElement.innerHTML = '';

        const usedColors = new Set();

        currentQ.shuffledOptions.forEach((option, index) => {
            const button = document.createElement('button');
            button.textContent = option;
            let color;
            do {
                color = getRandomPastelColor();
            } while (usedColors.has(color));
            usedColors.add(color);
            button.style.backgroundColor = color;
            if (userAnswers[currentQuestion] === index) {
                button.classList.add('selected');
            }
            button.onclick = () => selectAnswer(button, index);
            optionsElement.appendChild(button);
        });

        questionCounterElement.textContent = `第 ${currentQuestion + 1} 題 / 共 ${shuffledQuestions.length} 題`;

        document.getElementById('prevBtn').style.display = currentQuestion === 0 ? 'none' : 'inline-block';
        document.getElementById('nextBtn').style.display = currentQuestion === shuffledQuestions.length - 1 ? 'none' : 'inline-block';
        document.getElementById('finishBtn').style.display = currentQuestion === shuffledQuestions.length - 1 ? 'inline-block' : 'none';
    }

    function selectAnswer(button, index) {
        const optionButtons = document.querySelectorAll('.options button');
        optionButtons.forEach(btn => btn.classList.remove('selected'));
        button.classList.add('selected');
        userAnswers[currentQuestion] = index;
    }

    function nextQuestion() {
        if (userAnswers[currentQuestion] === undefined) {
            alert('請選擇一個答案');
            return;
        }
        currentQuestion++;
        displayQuestion();
    }

    function prevQuestion() {
        currentQuestion--;
        displayQuestion();
    }

    function finishQuiz() {
        if (userAnswers[currentQuestion] === undefined) {
            alert('請選擇一個答案');
            return;
        }
        calculateScore();
        displayResults();
    }

    function calculateScore() {
        score = userAnswers.reduce((total, answer, index) => {
            return total + (answer === shuffledQuestions[index].shuffledOptions.indexOf(shuffledQuestions[index].correctAnswer) ? 1 : 0);
        }, 0) * (100 / shuffledQuestions.length);
        score = score.toFixed(1);
    }

    function displayResults() {
        const resultLayer = document.getElementById('resultLayer');
        const resultContent = document.getElementById('resultContent');

        resultLayer.style.display = 'flex';
        resultContent.innerHTML = `<h2>您的總得分是 ${score} 分</h2>`;

        shuffledQuestions.forEach((question, index) => {
            const userAnswer = userAnswers[index];
            const correctAnswerIndex = question.shuffledOptions.indexOf(question.correctAnswer);

            if (userAnswer !== correctAnswerIndex) {
                const questionResult = document.createElement('div');
                questionResult.style.backgroundColor = getRandomPastelColor();
                questionResult.innerHTML = `<p class="wrong-question">${question.question}</p>`;

                question.shuffledOptions.forEach((option, optionIndex) => {
                    const optionElement = document.createElement('p');
                    optionElement.textContent = option;
                    if (userAnswer === optionIndex) {
                        optionElement.classList.add('incorrect');
                        optionElement.innerHTML += ' ❌';
                    }
                    if (correctAnswerIndex === optionIndex) {
                        optionElement.classList.add('correct-answer');
                        optionElement.innerHTML += ' ○';
                    }
                    questionResult.appendChild(optionElement);
                });

                resultContent.appendChild(questionResult);
            }
        });

        resultContent.innerHTML += `<button onclick="restartQuiz()">重新測驗</button>`;
    }

    function restartQuiz() {
        document.getElementById('resultLayer').style.display = 'none';
        startQuiz();
    }

    function getRandomPastelColor() {
        const hue = Math.floor(Math.random() * 360);
        return `hsl(${hue}, 100%, 85%)`;
    }

    function shuffleArray(array) {
        return array.map(a => [a, Math.random()]).sort((a, b) => a[1] - b[1]).map(a => a[0]);
    }

    function showGenerator() {
        document.getElementById('quizContainer').classList.remove('active');
        document.getElementById('generatorContainer').classList.add('active');
    }

    function parseGeneratorInput(input) {
        const lines = input.split('\n');
        const result = [];
        for (let line of lines) {
            const parts = line.split(/[\t,]/);
            if (parts.length === 6) {
                const [question, correct, ...options] = parts;
                let correctIndex;
                if (correct === '1' || correct.toUpperCase() === 'A') correctIndex = 0;
                else if (correct === '2' || correct.toUpperCase() === 'B') correctIndex = 1;
                else if (correct === '3' || correct.toUpperCase() === 'C') correctIndex = 2;
                else if (correct === '4' || correct.toUpperCase() === 'D') correctIndex = 3;
                result.push({ question, options, correct: correctIndex });
            }
        }
        return result;
    }

    function renderOutputTable(data) {
        const container = document.getElementById('outputTableContainer');
        container.innerHTML = '<table class="output-table"><thead><tr><th>題目</th><th>選項1</th><th>選項2</th><th>選項3</th><th>選項4</th><th>答案</th></tr></thead><tbody></tbody></table>';
        const tbody = container.querySelector('tbody');
        for (let item of data) {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${item.question}</td><td>${item.options[0]}</td><td>${item.options[1]}</td><td>${item.options[2]}</td><td>${item.options[3]}</td><td>${item.options[item.correct]}</td>`;
            tbody.appendChild(tr);
        }
        container.innerHTML += '<button class="start-quiz-btn" onclick="startQuizFromGenerator()">開始測驗</button>';
    }

    function submitGenerator() {
        const input = document.getElementById('generatorInput').value;
        questions = parseGeneratorInput(input);
        renderOutputTable(questions);
    }

    function startQuizFromGenerator() {
        document.getElementById('generatorContainer').classList.remove('active');
        document.getElementById('quizContainer').classList.add('active');
        startQuiz();
    }

    function downloadQuiz() {
        const originalHtml = document.documentElement.outerHTML;
        const textareaContent = document.getElementById('generatorInput').value;
        const newHtml = originalHtml.replace(
            /<textarea[^>]*>([\s\S]*?)<\/textarea>/,
            `<textarea id="generatorInput" placeholder="每行一筆資料，六欄用逗號或Tab隔開">${textareaContent}</textarea>`
        );
        const blob = new Blob([newHtml], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'chenchen.quiz.html';
        a.click();
        URL.revokeObjectURL(url);
    }

    document.addEventListener('DOMContentLoaded', function() {
        const inputElement = document.getElementById('generatorInput');
        let initialLoad = true;
        
        inputElement.addEventListener('input', function() {
            initialLoad = false;
        });

        if (inputElement.value.trim()) {
            submitGenerator();
            if (initialLoad) {
                startQuizFromGenerator();
            }
        }
    });

    document.addEventListener('keydown', function(event) {
        if (event.key === 'r') {
            showGenerator();
        }
    });
</script>


</body></html>